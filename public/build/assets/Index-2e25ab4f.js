import{_ as K}from"./AuthenticatedLayout-cb5bc9f2.js";import"./index.es-2a630ddc.js";import{D as Q,a as W,X as Z,n as $,E as ee,P as te,b as A,J as I,m as L,c as s,d as l,w as e,F as k,r as u,o as a,e as ae,f as w,g as m,j,t as v,h as _,i as h}from"./app-af2088fa.js";import{h as ne}from"./moment-fbc5633a.js";import{_ as le}from"./_plugin-vue_export-helper-c27b6911.js";import{P as ie}from"./PlusCircleOutlined-c46a5e36.js";import{M as oe}from"./MoreOutlined-dcafcb15.js";const se=[{title:"Name",key:"name",dataIndex:"name",sorter:!0,width:"20%"},{title:"Attendance Status",key:"status",width:"20%"},{title:"Late Status",key:"latestatus",width:"10%"},{title:"Action",key:"manualaction",width:"30%"}],ue=[{title:"Location",key:"location",dataIndex:""},{title:"In",key:"in",dataIndex:"checkin"},{title:"Out",key:"out",dataIndex:"checkout"},{title:"Break",key:"break",dataIndex:""},{title:"Notes",key:"notes",dataIndex:""},{title:"Action",key:"action",dataIndex:""}],de={components:{AuthenticatedLayout:K,DownloadOutlined:Q,PlusCircleOutlined:ie,MoreOutlined:oe,DeleteOutlined:W,Head:Z,Link:$,EditOutlined:ee},props:{date:String,employees:Object,breaks:Object,branches:Object,pagination:Object,errors:Object},setup(n){return{columns:se,innercolumns:ue}},data(n){const g=te({term:"",date:n.date,branch:null});return{moment:ne,editableData:[],statusColor:{Present:"green",Absent:"red","Paid Leave":"blue","Unpaid Leave":"orange","Day Off":"purple"},page:1,pageSize:50,loading:!1,delayTime:1500,formState:g,showmanualsave:[]}},methods:{search(){this.$inertia.get("/attendance",{s:this.formState.term,date:this.formState.date,branch:this.formState.branch,pageSize:this.pageSize},{preserveState:!0})},handleTableChange(n){this.page=n.current,this.pageSize=n.pageSize,console.log(n),this.$inertia.get("/attendance",{s:this.formState.term,date:this.formState.date,branch:this.formState.branch,page:n.current,pageSize:n.pageSize},{preserveState:!0})},clockIn(n){this.loading=!0,A.post(route("attendance.clockin"),{...n,date:this.formState.date}).then(o=>{console.log(o),this.$inertia.get("/attendance",{s:this.formState.term,date:this.formState.date,branch:this.formState.branch,page:this.page,pageSize:this.pageSize},{preserveState:!0})}).finally(()=>{this.loading=!1})},clockOut(n){this.loading=!0,A.post(route("attendance.clockout"),{...n,date:this.formState.date}).then(o=>{console.log(o),this.$inertia.get("/attendance",{s:this.formState.term,date:this.formState.date,branch:this.formState.branch,page:this.page,pageSize:this.pageSize},{preserveState:!0})}).finally(()=>{this.loading=!1})},addBreak(n,o){this.loading=!0,A.post(route("attendance.addbreak"),{...n,date:this.formState.date,breakid:o}).then(i=>{console.log(i),this.$inertia.get("/attendance",{s:this.formState.term,date:this.formState.date,branch:this.formState.branch,page:this.page,pageSize:this.pageSize},{preserveState:!0})}).finally(()=>{this.loading=!1})},edit(n){this.editableData.push(n)},cancel(n){const o=this.editableData.indexOf(n);o>-1&&this.editableData.splice(o,1)},savehistory(n){var o=route("attendance.updatehistory");I.post(o,n,{onStart:i=>{this.loading=!0},onSuccess:i=>{this.cancel(n.id)},onError:i=>{this.loading=!1,Object.keys(i).forEach(function(g){L.error(i[g])})},onFinish:i=>{this.loading=!1}})},deletehistory(n){I.post(route("attendance.deletehistory",n),{},{onStart:o=>{this.loading=!0},onSuccess:o=>{},onFinish:o=>{this.loading=!1}})},addmanualrows(n){n.history.push({employee_id:n.employee_id,attdate:n.attdate,id:"",checkin:"",checkout:"",breakid:"",notes:""}),this.showmanualsave.push(n.employee_id)},savemanualdata(n){var o=route("attendance.addmultiplehistory");I.post(o,n,{onStart:i=>{this.loading=!0},onSuccess:i=>{},onError:i=>{this.loading=!1,Object.keys(i).forEach(function(g){L.error(i[g])})},onFinish:i=>{this.loading=!1}})},deletemanualrow(n,o){const i=this.employees.indexOf(n);if(i>-1){const g=this.employees[i].history.indexOf(o);this.employees[i].history.splice(g,1)}if(this.employees[i].history.length==0){const g=this.showmanualsave.indexOf(n.employee_id);g>-1&&this.showmanualsave.splice(g,1)}}}},ce={href:"/attendance/summaryreport",download:"file.xlsx"},re={key:0},me={key:1},he={key:1},pe={key:1},_e={key:1},ye={key:1},fe={key:1},ke={class:"editable-row-operations"},ge={key:0},ve={key:1};function be(n,o,i,g,d,y){const Y=u("Head"),F=u("a-spin"),x=u("a-select-option"),O=u("a-select"),S=u("a-form-item"),T=u("a-date-picker"),U=u("a-input"),f=u("a-button"),M=u("a-form"),N=u("a-avatar"),D=u("a-tag"),P=u("a-menu-item"),V=u("a-menu"),J=u("DownOutlined"),R=u("a-dropdown"),C=u("a-space"),E=u("a-time-picker"),z=u("a-popconfirm"),X=u("EditOutlined"),H=u("DeleteOutlined"),B=u("a-table"),q=u("a-layout-content"),G=u("AuthenticatedLayout");return a(),s(k,null,[l(Y,{title:"Employees"}),l(G,null,{default:e(()=>[l(F,{spinning:d.loading,delay:d.delayTime},null,8,["spinning","delay"]),l(q,{style:ae({margin:"24px 16px",padding:"24px",background:"#fff",minHeight:"calc(100vh - 115px)",textAlign:"center"})},{default:e(()=>[l(C,{direction:"vertical",style:{width:"100%"}},{default:e(()=>[l(M,{name:"nest-messages",model:d.formState,layout:"inline",onFinish:y.search},{default:e(()=>[l(S,null,{default:e(()=>[l(O,{value:d.formState.branch,"onUpdate:value":o[0]||(o[0]=p=>d.formState.branch=p),placeholder:"Select Branch",style:{"min-width":"200px"}},{default:e(()=>[(a(!0),s(k,null,w(i.branches,p=>(a(),h(x,{value:p.id},{default:e(()=>[m(v(p.branch_name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),l(S,null,{default:e(()=>[l(T,{value:d.formState.date,"onUpdate:value":o[1]||(o[1]=p=>d.formState.date=p),format:"DD-MM-YYYY","value-format":"YYYY-MM-DD"},null,8,["value"])]),_:1}),l(S,null,{default:e(()=>[l(U,{placeholder:"Search Employees",value:d.formState.term,"onUpdate:value":o[2]||(o[2]=p=>d.formState.term=p)},null,8,["value"])]),_:1}),l(S,null,{default:e(()=>[l(f,{type:"primary","html-type":"submit"},{default:e(()=>[m(" Search ")]),_:1})]),_:1}),l(S,null,{default:e(()=>[j("a",ce,[l(f,{type:"primary"},{default:e(()=>[m(" Export ")]),_:1})])]),_:1})]),_:1},8,["model","onFinish"]),l(B,{columns:g.columns,"row-key":p=>p.employee_id,"data-source":i.employees,pagination:i.pagination,loading:d.loading,onChange:y.handleTableChange},{bodyCell:e(({column:p,text:b,record:c})=>[p.key==="name"?(a(),s(k,{key:0},[l(N,{style:{color:"#f56a00","background-color":"#fde3cf"}},{default:e(()=>[m(v(b[0].toUpperCase()),1)]),_:2},1024),m(" Â  "+v(b),1)],64)):_("",!0),p.key==="status"?(a(),h(D,{key:1,color:d.statusColor[c.status]},{default:e(()=>[m(v(c.status),1)]),_:2},1032,["color"])):_("",!0),p.key==="latestatus"?(a(),s(k,{key:2},[c.status=="Present"?(a(),h(D,{key:0,color:c.late==!0?"red":"green"},{default:e(()=>[m(v(c.late==!0?"Late":"On Time"),1)]),_:2},1032,["color"])):_("",!0)],64)):_("",!0),p.key==="autoaction"?(a(),h(C,{key:3,direction:"horizontal"},{default:e(()=>[c.history.length?(a(),s("div",re,[c.history[c.history.length-1].checkout!=null?(a(),h(f,{key:0,type:"primary",onClick:t=>y.clockIn(c)},{default:e(()=>[m("Clock In")]),_:2},1032,["onClick"])):_("",!0),c.history[c.history.length-1].checkout==null?(a(),h(f,{key:1,onClick:t=>y.clockOut(c)},{default:e(()=>[m("Clock Out")]),_:2},1032,["onClick"])):_("",!0),c.history[c.history.length-1].breakid==null?(a(),h(R,{key:2},{overlay:e(()=>[l(V,null,{default:e(()=>[(a(!0),s(k,null,w(i.breaks,t=>(a(),h(P,{key:t.id,onClick:r=>y.addBreak(c,t.id)},{default:e(()=>[m(v(t.name),1)]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),default:e(()=>[l(f,null,{default:e(()=>[m(" Break "),l(J)]),_:1})]),_:2},1024)):(a(),h(f,{key:3,onClick:t=>y.clockOut(c)},{default:e(()=>[m("Close Break")]),_:2},1032,["onClick"]))])):(a(),s("div",me,[l(f,{type:"primary",onClick:t=>y.clockIn(c)},{default:e(()=>[m("Clock In")]),_:2},1032,["onClick"])]))]),_:2},1024)):_("",!0),p.key==="manualaction"?(a(),s(k,{key:4},[l(f,{type:"default",danger:"",onClick:t=>y.addmanualrows(c)},{default:e(()=>[m("Add Attendance")]),_:2},1032,["onClick"]),d.showmanualsave.includes(c.employee_id)?(a(),h(f,{key:0,type:"primary",danger:"",onClick:t=>y.savemanualdata(c)},{default:e(()=>[m("Save Attendance")]),_:2},1032,["onClick"])):_("",!0)],64)):_("",!0)]),expandedRowRender:e(({record:p})=>[l(B,{class:"table-sm",pagination:!1,columns:g.innercolumns,"row-key":b=>b.id,"data-source":p.history,set:n.parentrecord=p},{bodyCell:e(({column:b,text:c,record:t})=>[b.key==="location"?(a(),s(k,{key:0},[t.id==""||d.editableData.includes(t.id)?(a(),h(O,{key:0,value:t.branchid,"onUpdate:value":r=>t.branchid=r,placeholder:"Select Branch",style:{"min-width":"200px"}},{default:e(()=>[(a(!0),s(k,null,w(i.branches,r=>(a(),h(x,{value:r.id},{default:e(()=>[m(v(r.branch_name),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value"])):(a(),s("div",he,v(t.branch.branch_name??"-"),1))],64)):_("",!0),b.key==="in"?(a(),s(k,{key:1},[t.id==""||d.editableData.includes(t.id)?(a(),h(E,{key:0,allowClear:!0,format:"hh:mm A",placeholder:"Check In","value-format":"HH:mm:ss",value:t.checkin,"onUpdate:value":r=>t.checkin=r},null,8,["value","onUpdate:value"])):(a(),s("div",pe,v(d.moment(t.checkin,"HH:mm:ss").format("hh:mm A")),1))],64)):_("",!0),b.key==="out"?(a(),s(k,{key:2},[t.id==""||d.editableData.includes(t.id)?(a(),h(E,{key:0,allowClear:!0,format:"hh:mm A",placeholder:"Check Out","value-format":"HH:mm:ss",value:t.checkout,"onUpdate:value":r=>t.checkout=r},null,8,["value","onUpdate:value"])):(a(),s("div",_e,v(t.checkout!=null?d.moment(t.checkout,"HH:mm:ss").format("hh:mm A"):"-"),1))],64)):_("",!0),b.key==="break"?(a(),s(k,{key:3},[t.id==""||d.editableData.includes(t.id)?(a(),h(O,{key:0,allowClear:!0,value:t.breakid,"onUpdate:value":r=>t.breakid=r,style:"width: 150px"},{default:e(()=>[(a(!0),s(k,null,w(i.breaks,r=>(a(),h(x,{value:r.id},{default:e(()=>[m(v(r.name),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["value","onUpdate:value"])):(a(),s("div",ye,[t.breakid!=null?(a(),h(D,{key:0,color:"blue"},{default:e(()=>[m(v(t.break.name),1)]),_:2},1024)):_("",!0)]))],64)):_("",!0),b.key==="notes"?(a(),s(k,{key:4},[t.id==""||d.editableData.includes(t.id)?(a(),h(U,{key:0,value:t.notes,"onUpdate:value":r=>t.notes=r,style:{width:"100%"}},null,8,["value","onUpdate:value"])):(a(),s("span",fe,v(t.notes),1))],64)):_("",!0),b.key==="action"?(a(),s(k,{key:5},[t.id!=""?(a(),h(C,{key:0,direction:"horizontal"},{default:e(()=>[j("div",ke,[t.id==""||d.editableData.includes(t.id)?(a(),s("span",ge,[l(f,{type:"primary",onClick:r=>y.savehistory(t)},{default:e(()=>[m("Save")]),_:2},1032,["onClick"]),l(z,{title:"Sure to cancel?",onConfirm:r=>y.cancel(t.id)},{default:e(()=>[l(f,{type:"default"},{default:e(()=>[m("Cancel")]),_:1})]),_:2},1032,["onConfirm"])])):(a(),s("span",ve,[l(f,{onClick:r=>y.edit(t.id)},{icon:e(()=>[l(X)]),_:2},1032,["onClick"])]))]),l(z,{title:"Sure to delete?",onConfirm:r=>y.deletehistory(t.id)},{default:e(()=>[l(f,null,{icon:e(()=>[l(H)]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):(a(),h(C,{key:1},{default:e(()=>[l(z,{title:"Sure to delete?",onConfirm:r=>y.deletemanualrow(n.parentrecord,t)},{default:e(()=>[l(f,null,{icon:e(()=>[l(H)]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024))],64)):_("",!0)]),_:2},1032,["columns","row-key","data-source","set"])]),_:1},8,["columns","row-key","data-source","pagination","loading","onChange"])]),_:1})]),_:1},8,["style"])]),_:1})],64)}const Ae=le(de,[["render",be]]);export{Ae as default};
